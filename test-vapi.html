<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Vapi - Ø²Ø± Ø¨Ø³ÙŠØ·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .status {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 16px;
            color: #555;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            margin: 10px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .stop-btn {
            background: linear-gradient(135deg, #f12711 0%, #f5af19 100%);
        }

        .info {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: right;
            font-size: 14px;
            line-height: 1.8;
        }

        .info strong {
            color: #856404;
        }

        .console-log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }

        .console-log div {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¤ Ø§Ø®ØªØ¨Ø§Ø± Vapi Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h1>

        <div id="status" class="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„</div>

        <div>
            <button id="startBtn" onclick="startVapiCall()">
                ğŸ“ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©
            </button>
            <button id="stopBtn" class="stop-btn" onclick="stopVapiCall()" style="display: none;">
                â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©
            </button>
        </div>

        <div class="info">
            <strong>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong><br>
            1. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ <strong>Public Key</strong> ÙÙŠ <code>vapi-config.js</code><br>
            2. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ <strong>Assistant ID</strong> (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)<br>
            3. Ø§ÙØªØ­ <strong>Developer Tools (F12)</strong> Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„<br>
            4. Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©" ÙˆØ§Ø³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
        </div>

        <div class="console-log" id="consoleLog"></div>
    </div>

    <!-- Vapi Web SDK with Fallback -->
    <script>
        // Check if SDK loaded successfully
        window.vapiSDKLoadAttempts = 0;
        window.vapiSDKLoaded = false;

        function checkVapiSDK() {
            if (typeof window.Vapi !== 'undefined') {
                console.log('âœ… Vapi SDK loaded successfully from CDN');
                window.vapiSDKLoaded = true;
                return true;
            }
            return false;
        }

        function loadVapiSDKFallback() {
            console.log('âš ï¸ Primary CDN failed, trying fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@vapi-ai/web@2.0.5/dist/index.js';
            script.onload = () => {
                if (checkVapiSDK()) {
                    console.log('âœ… Loaded from fallback CDN');
                } else {
                    console.error('âŒ Fallback CDN also failed');
                    alert('âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Vapi SDK\nØ§Ù„Ø±Ø¬Ø§Ø¡:\n1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. ØªØ¹Ø·ÙŠÙ„ Ad Blocker\n3. Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
                }
            };
            script.onerror = () => {
                console.error('âŒ All CDN attempts failed');
                alert('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Vapi SDK Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†:\nâ€¢ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\nâ€¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firewall/VPN\nâ€¢ Ø­Ø§Ø¬Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (Ad Blocker)');
            };
            document.head.appendChild(script);
        }
    </script>

    <!-- Primary CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/index.js" onload="checkVapiSDK()"
        onerror="loadVapiSDKFallback()"></script>

    <!-- Vapi Configuration & Service -->
    <script src="vapi-config.js"></script>
    <script src="vapi-service.js"></script>

    <script>
        // Diagnostic: Check what's loaded
        setTimeout(() => {
            console.log('=== DIAGNOSTIC CHECK ===');
            console.log('Vapi SDK:', typeof window.Vapi !== 'undefined' ? 'âœ… Loaded' : 'âŒ Not Loaded');
            console.log('VAPI_CONFIG:', typeof window.VAPI_CONFIG !== 'undefined' ? 'âœ… Loaded' : 'âŒ Not Loaded');
            console.log('VAPIService:', typeof window.VAPIService !== 'undefined' ? 'âœ… Loaded' : 'âŒ Not Loaded');

            if (window.VAPI_CONFIG) {
                console.log('Public Key:', window.VAPI_CONFIG.publicKey ? 'âœ… Present' : 'âŒ Missing');
                console.log('Assistant ID:', window.VAPI_CONFIG.assistantId ? 'âœ… Present' : 'âš ï¸ Empty (will use default)');
            }

            if (typeof window.Vapi === 'undefined') {
                console.error('âŒ Vapi SDK failed to load!');
                console.error('Possible reasons:');
                console.error('1. No internet connection');
                console.error('2. Ad Blocker blocking the CDN');
                console.error('3. Firewall/VPN blocking cdn.jsdelivr.net');
                console.error('4. Network restrictions in your country');
            }
            console.log('========================');
        }, 2000);
    </script>

    <script>
        const statusEl = document.getElementById('status');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const consoleLog = document.getElementById('consoleLog');

        let isCallActive = false;

        // Override console.log to show in UI
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };

        const originalError = console.error;
        console.error = function (...args) {
            originalError.apply(console, args);
            addLog('âŒ ' + args.join(' '), true);
        };

        function addLog(message, isError = false) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            div.style.color = isError ? '#ff6b6b' : '#00ff00';
            consoleLog.appendChild(div);
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        function updateStatus(message, type = 'normal') {
            statusEl.textContent = message;
            statusEl.className = 'status';
            if (type === 'active') statusEl.classList.add('active');
            if (type === 'error') statusEl.classList.add('error');
        }

        function updateButtons(calling) {
            isCallActive = calling;
            startBtn.style.display = calling ? 'none' : 'inline-block';
            stopBtn.style.display = calling ? 'inline-block' : 'none';
        }

        // Setup Vapi event listeners
        function setupVapiListeners() {
            if (!window.VAPIService || !window.VAPIService.instance) {
                console.log('â³ Waiting for Vapi...');
                setTimeout(setupVapiListeners, 500);
                return;
            }

            const vapi = window.VAPIService;

            vapi.on('call-start', () => {
                console.log('ğŸ“ Call started!');
                updateStatus('Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© Ù†Ø´Ø·Ø© - ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†', 'active');
                updateButtons(true);
            });

            vapi.on('call-end', () => {
                console.log('ğŸ“ Call ended');
                updateStatus('ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©');
                updateButtons(false);
            });

            vapi.on('speech-start', () => {
                console.log('ğŸ—£ï¸ User speaking');
                updateStatus('ÙŠØªÙ… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...', 'active');
            });

            vapi.on('speech-end', () => {
                console.log('ğŸ¤« User stopped');
                updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', 'active');
            });

            vapi.on('message', (message) => {
                console.log('ğŸ’¬ Message:', message.type);
                if (message.type === 'transcript' && message.role === 'assistant') {
                    updateStatus('Ø§Ù„ÙˆÙƒÙŠÙ„: ' + (message.transcript || message.text), 'active');
                }
            });

            vapi.on('error', (error) => {
                console.error('Vapi error:', error.message || error);
                updateStatus('Ø®Ø·Ø£: ' + (error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£'), 'error');
                updateButtons(false);
            });

            console.log('âœ… Event listeners ready');
        }

        async function startVapiCall() {
            console.log('ğŸ¯ Attempting to start call...');
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'active');
            startBtn.disabled = true;

            try {
                // Wait for Vapi to be ready
                let retries = 0;
                while ((!window.VAPIService || !window.VAPIService.instance) && retries < 20) {
                    console.log('â³ Waiting for Vapi initialization...');
                    await new Promise(r => setTimeout(r, 500));
                    retries++;
                }

                if (!window.VAPIService || !window.VAPIService.instance) {
                    throw new Error('Vapi failed to initialize after 10 seconds');
                }

                console.log('âœ… Vapi is ready');
                await window.VAPIService.startCall();

            } catch (error) {
                console.error('Failed to start call:', error.message);
                updateStatus('Ø®Ø·Ø£: ' + error.message, 'error');
                startBtn.disabled = false;
            }
        }

        function stopVapiCall() {
            console.log('ğŸ›‘ Stopping call...');
            if (window.VAPIService) {
                window.VAPIService.endCall();
            }
            updateStatus('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©');
            updateButtons(false);
        }

        // Initialize
        window.addEventListener('load', () => {
            console.log('ğŸ“¦ Page loaded, setting up Vapi...');
            setTimeout(setupVapiListeners, 1000);
        });
    </script>
</body>

</html>